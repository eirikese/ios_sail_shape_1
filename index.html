<!DOCTYPE html>
<html>
<head>
    <title>Video Stream</title>
</head>
<body>
    <h1>Processed Video Feed (Black & White)</h1>
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Access the device camera
        navigator.mediaDevices.getUserMedia({ video: true })
            .then((stream) => {
                video.srcObject = stream;

                const mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'video/webm; codecs=vp8',
                });

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        const reader = new FileReader();
                        reader.onload = () => {
                            fetch('http://192.168.10.167:5000/video_feed', {
                                method: 'POST',
                                body: reader.result,
                                headers: { 'Content-Type': 'application/octet-stream' },
                            })
                            .then((response) => response.json())
                            .then((data) => {
                                const processedImage = new Image();
                                processedImage.src = 'data:image/jpeg;base64,' + data.processed_frame;
                                processedImage.onload = () => {
                                    canvas.width = processedImage.width;
                                    canvas.height = processedImage.height;
                                    ctx.drawImage(processedImage, 0, 0);
                                };
                            })
                            .catch(console.error);
                        };
                        reader.readAsArrayBuffer(event.data);
                    }
                };

                mediaRecorder.start(100); // Send frames every 100ms
            })
            .catch((err) => {
                console.error('Camera access denied:', err);
            });
    </script>
</body>
</html>
